# Author : Ali Taqi Wajid
### Notes are mainly from Sektor7 Malware Development Essentials
---


# What are PE Files:
PE -> Portable executable format. It is a way to organize data into a file so that a windows component called LOADER can read it from disk and load it as a process and read it.

## Structure of PE File:
Consider a PE file is a book. But way too more complex. A book may have data (the actual book content) and a metadata(title, author etc). In the same way, PE files are organized into headers and sections.

### Headers:
Headers contain the meta data or the technical details about the executable binary itself. Headers contain the following:
- DOS Header
- PE Header
- Optional Header
- Data Directories
- Sections Table

### Sections:
The section contains the contents of the executable. These may or may not be limited to:
- Source Code
- Imports (Resources)
- Data (Information used by the code.)

[Pics](https://github.com/corkami/pics) is a a great resource that contains multiple file in a visualized form. We can see PE file from there. The exact url is : [PE101](https://github.com/corkami/pics/blob/master/pe101/README.md)

# Utilities:
## PEBear
Opened calculator in PEBear to get to know about PEBear.
![[Pasted image 20210811014731.png]]
Now, going to section header shows us different headers:
![[Pasted image 20210811014822.png]]
### Text:
Text contains the executable code
### RDATA:
Contains the read-only data
### DATA:
Application, module and global variables
### PDATA:
Stores data about the exceptions
### RSRC:
This is a section that is very important to a malware developer. It can contain different objects. Can contain picture, audio, manifest files etc. It can also store other PE files or DLLs.
### RELOC:
Contains the information about the relocation. Allows the windows loader to safely load a module such as DLL into memory safely with ASLR enabled.

Most important section to us are `.text, .data, .rsrc`.

## dumpbin
Works with Visual Studio Native Tools CMD. dumpbin is a command. The following command will dump us the same data in the CLI of the same calc binary in the cmd: `dumpbin /headers C:\windows\system32\calc.exe`

# Droppers:
Droppers are special program that are used to deliver the payload to the target machine. A dropper is a PE file that has our payload within itself. We can store the payload in the important sections we highlighted above and then can be called later to avoid AV detection etc.

---

# Important Commands:
-> To display the exported functions of a dll:
```batch
dumpbin /exports C:\path\to\dll\main.dll
```
-> To call an external function from a dll:
```batch
run32dll C:\path\to\dll\main.dll,exported_function
```